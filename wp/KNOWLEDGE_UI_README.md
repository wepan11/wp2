# 知识库UI使用指南

## 概述

知识库管理界面是一个功能完整的单页应用（SPA），提供了浏览、筛选、排序和导出知识库条目的能力。界面采用现代化设计，响应式布局，支持桌面和移动设备访问。

## 访问地址

- **UI地址**: `http://your-server:port/kb`
- **API文档**: `http://your-server:port/docs`

## 功能特性

### 1. API密钥认证

首次访问时需要输入API密钥：
- API密钥存储在浏览器localStorage中
- 支持密码输入框保护隐私
- 认证失败会自动清除存储的密钥

### 2. 数据浏览

**数据表格**:
- 支持分页浏览（20/50/100/200条/页）
- 可自定义显示列
- 内联操作按钮（复制链接、复制密码、打开原始链接）
- 鼠标悬停显示完整内容

**默认显示列**:
- 文章标题
- 标签
- 原始分享链接/密码
- 新分享链接/密码
- 状态
- 创建时间

### 3. 筛选功能

**关键词搜索**:
- 支持搜索标题、文章ID、URL、链接
- 回车快速触发搜索

**状态筛选**:
- 多选复选框
- 支持的状态：pending, processing, transferred, completed, failed
- 显示每个状态的条目数量

**标签筛选**:
- 下拉选择
- 标签从文章URL自动提取（第二级路径）

**日期范围**:
- 原生`<input type="date">`控件
- 支持设置起始日期和结束日期

**排序控制**:
- 可选字段：创建时间、更新时间、标题、状态
- 可选方向：升序(ASC)、降序(DESC)

### 4. 列管理

点击"列设置"按钮打开列管理模态框：
- 复选框勾选要显示的列
- "全选"按钮快速切换所有列
- 列设置立即应用到表格
- 导出CSV时使用相同的列选择

**可用列**:
- article_id - 文章ID
- article_title - 文章标题
- article_url - 文章链接
- tag - 标签
- original_link - 原始分享
- original_password - 原始密码
- new_link - 新分享
- new_password - 新密码
- new_title - 新标题
- status - 状态
- error_message - 错误信息
- created_at - 创建时间
- updated_at - 更新时间

### 5. CSV导出

点击"导出"按钮打开导出确认模态框：
- 显示将要导出的列
- 显示当前应用的筛选条件
- 确认后下载CSV文件
- 文件名格式：`knowledge_export_YYYY-MM-DD.csv`
- UTF-8编码，包含BOM以支持Excel正确显示中文

**导出特性**:
- 导出内容受筛选条件影响
- 导出列由列管理设置控制
- 流式下载，支持大数据量

### 6. 统计概览

侧边栏显示状态统计卡片：
- 待处理 (pending)
- 处理中 (processing)
- 已转存 (transferred)
- 已完成 (completed)
- 失败 (failed)

每个状态显示对应的条目数量，并使用不同颜色标识。

### 7. 交互体验

**加载状态**:
- 加载动画
- 错误提示（带重试按钮）
- 空数据提示

**Toast通知**:
- 成功操作（绿色）
- 错误信息（红色）
- 普通提示（蓝色）
- 3秒自动消失

**剪贴板**:
- 点击按钮快速复制链接/密码
- 支持现代浏览器Clipboard API
- 降级方案支持旧版浏览器

**响应式设计**:
- 桌面：侧边栏+主内容区域
- 平板/手机：垂直堆叠布局
- 表格水平滚动适配小屏幕

## 技术实现

### 技术栈
- **前端**: Vanilla JavaScript (ES6+), HTML5, CSS3
- **依赖**: 无外部框架或库
- **后端**: Flask + 知识库API蓝图

### 文件结构
```
wp/static/knowledge/
├── index.html    # 主HTML页面
├── style.css     # 样式表
└── app.js        # JavaScript应用逻辑
```

### API集成
- `GET /api/knowledge/entries` - 获取条目列表
- `GET /api/knowledge/tags` - 获取标签列表
- `GET /api/knowledge/statuses` - 获取状态统计
- `GET /api/knowledge/export` - 导出CSV

所有API请求需要在请求头中包含 `X-API-Key`。

### 状态管理
- API密钥存储：`localStorage.kb_api_key`
- 当前页码、页大小、筛选条件在应用实例中维护
- 列可见性设置在运行时动态管理

## 使用示例

### 基本工作流程

1. **初次访问**:
   ```
   访问 /kb -> 显示API密钥输入界面 -> 输入密钥 -> 验证成功后显示主界面
   ```

2. **浏览数据**:
   ```
   加载初始数据 -> 显示前50条 -> 使用分页浏览更多
   ```

3. **应用筛选**:
   ```
   输入关键词 -> 勾选状态 -> 设置日期范围 -> 点击"应用筛选"
   ```

4. **导出数据**:
   ```
   设置筛选条件 -> 调整列设置 -> 点击"导出" -> 确认 -> 下载CSV
   ```

### 常见操作

**搜索特定文章**:
1. 在"关键词搜索"输入框输入文章标题关键词
2. 按回车或点击"应用筛选"

**查看失败条目**:
1. 在状态筛选中仅勾选"失败"
2. 点击"应用筛选"
3. 在列设置中启用"错误信息"列

**批量复制链接**:
1. 应用需要的筛选条件
2. 逐行点击"📋 链接"按钮复制
3. 或使用导出功能导出到CSV后处理

**按时间范围导出**:
1. 设置"日期范围"起始和结束日期
2. 点击"应用筛选"
3. 点击"导出"按钮
4. 确认并下载

## 浏览器兼容性

支持的浏览器：
- Chrome/Edge 90+
- Firefox 88+
- Safari 14+

核心功能使用标准Web API，不依赖特定浏览器特性。

## 开发和定制

### 添加新列

1. 在 `app.js` 中的 `COLUMN_DEFINITIONS` 添加列定义：
   ```javascript
   { key: 'new_field', label: '新字段', default: false }
   ```

2. 在 `formatCell` 方法中添加格式化逻辑（如需要）

3. 确保后端返回该字段数据

### 修改样式

所有样式定义在 `style.css` 中：
- CSS变量（`:root`）定义颜色主题
- 响应式断点：1200px（平板）、768px（手机）
- 状态徽章和标签芯片样式可独立修改

### 调试

浏览器开发者工具：
- Console：查看API请求和错误
- Network：监控API调用
- Application：检查localStorage中的API密钥

## 故障排除

**问题：API密钥验证失败**
- 检查密钥是否正确
- 确认后端配置的 `API_SECRET_KEY`
- 查看浏览器控制台网络请求

**问题：数据不显示**
- 检查后端API是否正常运行
- 确认数据库中有数据
- 查看浏览器控制台错误信息

**问题：导出失败**
- 检查列设置是否为空
- 确认有符合条件的数据
- 查看后端日志

**问题：样式错乱**
- 清除浏览器缓存
- 确认 `style.css` 正确加载
- 检查浏览器兼容性

## 性能优化

- 分页加载，避免一次性加载大量数据
- 按需渲染表格行
- CSV导出使用流式下载
- 响应式图片和资源优化

## 安全性

- API密钥存储在localStorage，仅客户端可访问
- 所有API请求通过HTTPS传输（生产环境）
- XSS防护：所有用户输入经过HTML转义
- CORS配置限制跨域访问

## 更新日志

### v1.0.0 (初始版本)
- 完整的数据浏览和分页功能
- 多维度筛选（关键词、状态、标签、日期）
- 自定义列显示
- CSV导出
- 响应式设计
- 状态统计概览

## 许可证

与主项目许可证一致。

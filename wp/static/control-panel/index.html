<!DOCTYPE html>
<!--
  Control Panel Browse UI
  
  Required assets:
  - css/control-panel.css: Main stylesheet for control panel layout and components
  - js/main.js: Core application logic, API key management, account selection, and event bus
  - js/browse.js: Browse module for file listing, search, breadcrumb navigation, and file details
  
  Features:
  - API key authentication with localStorage persistence
  - Multi-account support with account selector
  - File browsing with breadcrumb navigation
  - File search with debounced input
  - File details drawer with metadata display
  - Loading, error, and empty state handling
  - Responsive layout with sidebar navigation
  - Placeholder sections for queue and settings tabs
  
  API Endpoints Used:
  - GET /api/info: Fetch available accounts
  - GET /api/files/list?path={path}&account={account}: List directory contents
  - GET /api/files/search?keyword={keyword}&path={path}&account={account}: Search files
  
  Access:
  - Direct: /static/control-panel/index.html
  - Route (pending): /control
-->
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>百度网盘控制面板 - Control Panel</title>
    <link rel="stylesheet" href="css/control-panel.css">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-content">
                <h1>🗂️ 百度网盘控制面板</h1>
                <div class="header-info">
                    <span id="accountInfo" class="account-info"></span>
                </div>
            </div>
        </header>

        <div id="apiKeySection" class="api-key-section">
            <div class="api-key-card">
                <h3>🔑 API Key 配置</h3>
                <p class="subtitle">请输入API密钥以访问控制面板</p>
                <div class="api-key-input-group">
                    <input type="password" id="apiKeyInput" placeholder="输入您的API密钥" />
                    <button id="saveApiKeyBtn" class="btn btn-primary">保存</button>
                </div>
            </div>
        </div>

        <main id="mainContent" class="main-content" style="display: none;">
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <h3>导航</h3>
                    <ul class="nav-list">
                        <li>
                            <a href="#" class="nav-item active" data-tab="browse">
                                📁 浏览文件
                            </a>
                        </li>
                        <li>
                            <a href="#" class="nav-item" data-tab="queue">
                                📋 任务队列
                            </a>
                        </li>
                        <li>
                            <a href="#" class="nav-item" data-tab="settings">
                                ⚙️ 设置
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="account-section">
                    <h3>账户</h3>
                    <div id="accountSelector">
                        <select id="accountSelect" class="account-select">
                            <option value="">选择账户...</option>
                        </select>
                    </div>
                </div>

                <div class="dashboard-summary" id="dashboardSummary" style="display: none;">
                    <h3>系统概览</h3>
                    <div class="summary-stats">
                        <div class="stat-item">
                            <span class="stat-label">转存待处理</span>
                            <span class="stat-value" id="dashTransferPending">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">转存运行中</span>
                            <span class="stat-value" id="dashTransferRunning">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">分享待处理</span>
                            <span class="stat-value" id="dashSharePending">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">分享运行中</span>
                            <span class="stat-value" id="dashShareRunning">0</span>
                        </div>
                    </div>
                    <button id="refreshDashboardBtn" class="btn btn-secondary btn-sm" style="width: 100%; margin-top: 0.5rem;">
                        🔄 刷新
                    </button>
                </div>
            </nav>

            <section class="content-area">
                <section id="browseView" class="tab-view active" style="display: flex;">
                    <div class="view-header">
                        <h2>浏览文件</h2>
                        <div class="view-actions">
                            <button id="refreshFilesBtn" class="btn btn-secondary btn-sm">
                                <span class="icon">🔄</span> 刷新
                            </button>
                        </div>
                    </div>

                    <div class="browse-controls">
                        <div class="breadcrumbs">
                            <div id="breadcrumbsContainer" class="breadcrumbs-container"></div>
                        </div>
                        <div class="search-bar">
                            <input type="text" id="searchInput" placeholder="搜索文件..." />
                            <button id="searchBtn" class="btn btn-primary btn-sm">搜索</button>
                            <button id="clearSearchBtn" class="btn btn-secondary btn-sm" style="display: none;">清除</button>
                        </div>
                    </div>

                    <div id="loadingState" class="state-message loading">
                        <div class="spinner"></div>
                        <p>加载中...</p>
                    </div>

                    <div id="errorState" class="state-message error" style="display: none;">
                        <p class="error-icon">⚠️</p>
                        <p id="errorMessage">加载失败</p>
                        <button id="retryBtn" class="btn btn-secondary">重试</button>
                    </div>

                    <div id="emptyState" class="state-message empty" style="display: none;">
                        <p class="empty-icon">📭</p>
                        <p id="emptyMessage">暂无文件</p>
                    </div>

                    <div id="filesContainer" class="files-container" style="display: none;">
                        <div id="filesList" class="files-list"></div>
                    </div>

                    <div id="fileDetailsDrawer" class="file-details-drawer" style="display: none;">
                        <div class="drawer-header">
                            <h3>文件详情</h3>
                            <button id="closeDrawerBtn" class="btn-close">&times;</button>
                        </div>
                        <div id="fileDetailsContent" class="drawer-content"></div>
                        <div class="drawer-actions">
                            <button id="copyPathBtn" class="btn btn-secondary btn-sm">复制路径</button>
                            <button id="queueShareBtn" class="btn btn-primary btn-sm">加入分享队列</button>
                        </div>
                    </div>
                </section>

                <section id="queueView" class="tab-view" style="display: none;">
                    <div class="view-header">
                        <h2>任务队列</h2>
                        <div class="view-actions">
                            <label class="toggle-label">
                                <input type="checkbox" id="autoRefreshToggle" checked />
                                <span>自动刷新</span>
                            </label>
                            <button id="refreshQueuesBtn" class="btn btn-secondary btn-sm">
                                <span class="icon">🔄</span> 刷新
                            </button>
                        </div>
                    </div>

                    <div id="queueLoadingState" class="state-message loading">
                        <div class="spinner"></div>
                        <p>加载队列数据...</p>
                    </div>

                    <div id="queueErrorState" class="state-message error" style="display: none;">
                        <p class="error-icon">⚠️</p>
                        <p id="queueErrorMessage">加载失败</p>
                        <button id="retryQueueBtn" class="btn btn-secondary">重试</button>
                    </div>

                    <div id="queueContent" class="queue-content" style="display: none;">
                        <div class="queue-grid">
                            <div class="queue-section">
                                <div class="queue-section-header">
                                    <h3>📥 转存队列</h3>
                                    <span id="transferLastUpdate" class="last-update"></span>
                                </div>

                                <div id="transferSummary" class="summary-cards">
                                    <div class="summary-card">
                                        <div class="summary-label">待处理</div>
                                        <div class="summary-value" id="transferPending">0</div>
                                    </div>
                                    <div class="summary-card">
                                        <div class="summary-label">进行中</div>
                                        <div class="summary-value" id="transferRunning">0</div>
                                    </div>
                                    <div class="summary-card success">
                                        <div class="summary-label">已完成</div>
                                        <div class="summary-value" id="transferCompleted">0</div>
                                    </div>
                                    <div class="summary-card error">
                                        <div class="summary-label">失败</div>
                                        <div class="summary-value" id="transferFailed">0</div>
                                    </div>
                                </div>

                                <div class="queue-controls">
                                    <button id="startTransferBtn" class="btn btn-sm btn-success">▶️ 开始</button>
                                    <button id="pauseTransferBtn" class="btn btn-sm btn-secondary">⏸️ 暂停</button>
                                    <button id="resumeTransferBtn" class="btn btn-sm btn-primary">▶️ 继续</button>
                                    <button id="stopTransferBtn" class="btn btn-sm btn-danger">⏹️ 停止</button>
                                    <button id="clearTransferBtn" class="btn btn-sm btn-secondary">🗑️ 清空</button>
                                    <button id="exportTransferBtn" class="btn btn-sm btn-secondary">📤 导出</button>
                                </div>

                                <div id="transferQueueTable" class="queue-table-container">
                                    <table class="queue-table">
                                        <thead>
                                            <tr>
                                                <th>状态</th>
                                                <th>链接</th>
                                                <th>目标路径</th>
                                                <th>时间</th>
                                            </tr>
                                        </thead>
                                        <tbody id="transferQueueBody">
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="queue-section">
                                <div class="queue-section-header">
                                    <h3>📤 分享队列</h3>
                                    <span id="shareLastUpdate" class="last-update"></span>
                                </div>

                                <div id="shareSummary" class="summary-cards">
                                    <div class="summary-card">
                                        <div class="summary-label">待处理</div>
                                        <div class="summary-value" id="sharePending">0</div>
                                    </div>
                                    <div class="summary-card">
                                        <div class="summary-label">进行中</div>
                                        <div class="summary-value" id="shareRunning">0</div>
                                    </div>
                                    <div class="summary-card success">
                                        <div class="summary-label">已完成</div>
                                        <div class="summary-value" id="shareCompleted">0</div>
                                    </div>
                                    <div class="summary-card error">
                                        <div class="summary-label">失败</div>
                                        <div class="summary-value" id="shareFailed">0</div>
                                    </div>
                                </div>

                                <div class="queue-controls">
                                    <button id="startShareBtn" class="btn btn-sm btn-success">▶️ 开始</button>
                                    <button id="pauseShareBtn" class="btn btn-sm btn-secondary">⏸️ 暂停</button>
                                    <button id="resumeShareBtn" class="btn btn-sm btn-primary">▶️ 继续</button>
                                    <button id="stopShareBtn" class="btn btn-sm btn-danger">⏹️ 停止</button>
                                    <button id="clearShareBtn" class="btn btn-sm btn-secondary">🗑️ 清空</button>
                                    <button id="exportShareBtn" class="btn btn-sm btn-secondary">📤 导出</button>
                                </div>

                                <div id="shareQueueTable" class="queue-table-container">
                                    <table class="queue-table">
                                        <thead>
                                            <tr>
                                                <th>状态</th>
                                                <th>文件</th>
                                                <th>分享链接</th>
                                                <th>时间</th>
                                            </tr>
                                        </thead>
                                        <tbody id="shareQueueBody">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="settingsView" class="tab-view" style="display: none;">
                    <div class="view-header">
                        <h2>设置</h2>
                        <div class="view-actions">
                            <button id="saveSettingsBtn" class="btn btn-primary btn-sm">
                                <span class="icon">💾</span> 保存设置
                            </button>
                        </div>
                    </div>

                    <div id="settingsLoadingState" class="state-message loading">
                        <div class="spinner"></div>
                        <p>加载设置...</p>
                    </div>

                    <div id="settingsContent" class="settings-content" style="display: none;">
                        <div class="settings-section">
                            <h3>⚡ 节流配置 (Throttle Settings)</h3>
                            <p class="help-text">控制API调用频率以避免触发速率限制</p>
                            
                            <div class="settings-grid">
                                <div class="setting-item">
                                    <label for="jitter_ms_min">最小延迟 (ms)</label>
                                    <input type="number" id="jitter_ms_min" min="0" max="10000" />
                                    <span class="help-text">每次请求的最小随机延迟</span>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="jitter_ms_max">最大延迟 (ms)</label>
                                    <input type="number" id="jitter_ms_max" min="0" max="10000" />
                                    <span class="help-text">每次请求的最大随机延迟</span>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="ops_per_window">时间窗口操作数</label>
                                    <input type="number" id="ops_per_window" min="1" max="1000" />
                                    <span class="help-text">每个时间窗口允许的最大操作数</span>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="window_sec">时间窗口 (秒)</label>
                                    <input type="number" id="window_sec" min="1" max="3600" />
                                    <span class="help-text">操作计数的时间窗口</span>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="window_rest_sec">窗口休息时间 (秒)</label>
                                    <input type="number" id="window_rest_sec" min="0" max="600" />
                                    <span class="help-text">达到窗口限制后的休息时间</span>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="max_consecutive_failures">最大连续失败次数</label>
                                    <input type="number" id="max_consecutive_failures" min="1" max="100" />
                                    <span class="help-text">触发暂停前的最大失败次数</span>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="pause_sec_on_failure">失败后暂停时间 (秒)</label>
                                    <input type="number" id="pause_sec_on_failure" min="0" max="3600" />
                                    <span class="help-text">达到最大失败后的暂停时间</span>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="cooldown_on_errno_62_sec">错误-62冷却时间 (秒)</label>
                                    <input type="number" id="cooldown_on_errno_62_sec" min="0" max="3600" />
                                    <span class="help-text">遇到访问限制错误后的冷却时间</span>
                                </div>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>👷 工作线程配置 (Worker Settings)</h3>
                            <p class="help-text">控制并发工作线程数量</p>
                            
                            <div class="settings-grid">
                                <div class="setting-item">
                                    <label for="max_transfer_workers">最大转存工作线程</label>
                                    <input type="number" id="max_transfer_workers" min="1" max="10" />
                                    <span class="help-text">同时运行的转存工作线程数</span>
                                </div>
                                
                                <div class="setting-item">
                                    <label for="max_share_workers">最大分享工作线程</label>
                                    <input type="number" id="max_share_workers" min="1" max="10" />
                                    <span class="help-text">同时运行的分享工作线程数</span>
                                </div>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>🚦 速率限制 (Rate Limiting)</h3>
                            <p class="help-text">全局API速率限制开关</p>
                            
                            <div class="setting-item">
                                <label class="toggle-label">
                                    <input type="checkbox" id="rate_limit_enabled" />
                                    <span>启用速率限制</span>
                                </label>
                                <span class="help-text">为API端点启用全局速率限制</span>
                            </div>
                        </div>

                        <div class="settings-section">
                            <h3>🎨 界面偏好 (UI Preferences)</h3>
                            <p class="help-text">自定义控制面板行为</p>
                            
                            <div class="settings-grid">
                                <div class="setting-item">
                                    <label for="auto_refresh_interval">自动刷新间隔 (毫秒)</label>
                                    <input type="number" id="auto_refresh_interval" min="1000" max="60000" step="1000" />
                                    <span class="help-text">队列视图自动刷新的间隔时间</span>
                                </div>
                                
                                <div class="setting-item">
                                    <label class="toggle-label">
                                        <input type="checkbox" id="api_key_retention" />
                                        <span>记住API密钥</span>
                                    </label>
                                    <span class="help-text">在浏览器中保存API密钥（本地存储）</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </section>
        </main>
    </div>

    <div id="toast" class="toast" style="display: none;"></div>

    <script src="js/main.js"></script>
    <script src="js/browse.js"></script>
    <script src="js/queue.js"></script>
    <script src="js/settings.js"></script>
</body>
</html>
